# Maintainer: Enlightenment Developers <enlightenment-devel@enlightenment.org>
pkgname=('efl' 'efl_doc' 'efl_x11')
pkgver=@VERSION@
pkgrel=1
pkgdesc="Enlightenment Foundation Libraries"
arch=('i686' 'x86_64' 'arm')
url="http://www.enlightenment.org"
license=('BSD' 'LGPL2' 'GPL2')
depends=('bullet' 'libpng' 'libjpeg-turbo' 'gstreamer0.10' 'zlib' 'lua' 'libtiff' 'openssl' 'util-linux' 'curl' 'dbus-core' 'glibc' 'fontconfig' 'freetype2' 'fribidi' 'libpulse' 'libsndfile' 'systemd' 'libx11' 'libxau' 'libxcomposite' 'libxdamage' 'libxdmcp' 'libxext' 'libxfixes' 'libxinerama' 'libxi' 'libxrandr' 'libxrender' 'libxss' 'libxtst' ' libgl' 'giflib')
provides=()
replaces=()
options=('strip' 'docs' 'zipman')
buildflags="-fvisibility=hidden -fomit-frame-pointer"
build() {
  cd ".."
  ./configure --prefix=/usr \
  --disable-static --enable-fb --disable-tslib --enable-xinput22
  make
  make doc
}

check() {
  cd ".."
  make -k check
}

package_efl() {
  cd ".."
  rm -rf $pkgdir/usr
  make DESTDIR="$pkgdir/" install
  install -Dm644 README $pkgdir/usr/share/$pkgname/licenses/$pkgname/README
  install -Dm644 NEWS $pkgdir/usr/share/$pkgname/licenses/$pkgname/NEWS
  install -Dm644 ChangeLog $pkgdir/usr/share/$pkgname/licenses/$pkgname/ChangeLog
  install -Dm644 COMPLIANCE $pkgdir/usr/share/$pkgname/licenses/$pkgname/COMPLIANCE
  install -Dm644 AUTHORS $pkgdir/usr/share/$pkgname/licenses/$pkgname/AUTHORS
  install -Dm644 licenses/COPYING.BSD $pkgdir/usr/share/$pkgname/licenses/$pkgname/licenses/COPYING.BSD
  install -Dm644 licenses/COPYING.GPL $pkgdir/usr/share/$pkgname/licenses/$pkgname/licenses/COPYING.GPL
  install -Dm644 licenses/COPYING.LGPL $pkgdir/usr/share/$pkgname/licenses/$pkgname/licenses/COPYING.LGPL
  install -Dm644 licenses/COPYING.SMALL $pkgdir/usr/share/$pkgname/licenses/$pkgname/licenses/COPYING.SMALL
  rm -rf \
  $pkgdir/usr/include/evas-1/Evas_Engine_*_X11.h \
  $pkgdir/usr/include/ecore-x-1 \
  $pkgdir/usr/lib/evas/modules/engines/*_x11 \
  $pkgdir/usr/lib/ecore_evas/engines/x \
  $pkgdir/usr/lib/libecore_x* \
  $pkgdir/usr/lib/pkgconfig/ecore-x.pc \
  $pkgdir/usr/lib/pkgconfig/evas-*-x11.pc
}

package_efl_doc() {
  cd ".."
  rm -rf $pkgdir/usr
  make DESTDIR="$pkgdir/" install
  mkdir -p $pkgdir/usr/share/man/man3
  cp -r doc/html $pkgdir/usr/share/$pkgname/
  cp -r doc/latex $pkgdir/usr/share/$pkgname/latex
}

package_efl_x11() {
  cd ".."
  rm -rf $pkgdir/usr
  make DESTDIR="$pkgdir/" install
  tar cf xf.tar \
  $pkgdir/usr/include/evas-1/Evas_Engine_*_X11.h \
  $pkgdir/usr/include/ecore-x-1 \
  $pkgdir/usr/lib/evas/modules/engines/*_x11 \
  $pkgdir/usr/lib/ecore_evas/engines/x \
  $pkgdir/usr/lib/libecore_x* \
  $pkgdir/usr/lib/pkgconfig/ecore-x.pc \
  $pkgdir/usr/lib/pkgconfig/evas-*-x11.pc
  rm -rf $pkgdir/usr
  tar -C / -P -xf xf.tar 
}
